# 一、主题

## 图形原理

> 图像在计算机中是如何表示的？图像压缩方式？JPG与PNG的特点和区别？YVU怎么表示图像？视频帧原理？

# 二、使用场景

> 图片、视频

# 三、介绍

### 1.Bitmap（例）

* ARGB
  
  > A：Alpha
  > 
  > R：Red
  > 
  > G：Green
  > 
  > B：Blue

* 图像组成：每个像素都由一个ARGB组成，每个色值数值为0～255，用一个无符号字节表示，为4个字节大小。即如果使用ARGB，每个像素都有256×256×256x256=4294967296种颜色表示

* 原始位图大小计算：如：100x100像素图片，为100x100x4 = 40000个字节

* Bitmap储存方案：
  
  > ARGB_8888：这种方案就是上面所说的每个通道值采8bit来表示，每个像素点需要4字节的内存空间来存储数据。该方案图片质量是最高的，但是占用的内存也是最大的
  > 
  > ARGB_4444：这种方案每个通道都是4位，每个像素占用2个字节，图片的失真比较严重。一般不用这种方案。
  > 
  > RGB_565：这种方案RGB通道值分别占5、6、5位，但是没有存储A通道值，所以不支持透明度。每个像素点占用2字节，是ARGB_8888方案的一半。
  > 
  > ALPHA_8：这种方案不支持颜色值，只存储透明度A通道值，使用场景特殊，比如设置遮盖效果等。

### 2.图片压缩

###### 1.图片是如何压缩的？

> 设想：如果一张纯白100x100像素的图片，用40000个字节储存，是否会造成多余浪费？如果只储存4个字节（FFFFFFFF）再表明是100x100的话呢？又或者Alpha通道是否可以压缩？只用3个字节表示呢？

###### 2.图片压缩原理

* 最简单原理（抽象，同位计算）
  
  > [100,100,100,120,140]，表示5个像素，可以将相邻像素相等的色值做统计，即[3x100,120,140]，实现压缩

* 空间冗余
  
  > 一幅图像表面上各采样点的颜色之间往往存在着空间连贯性，比如下图，两只老鼠的颜色，背后的墙，灰色的地板，颜色都一样。这些颜色相同的块就可以压缩。
  > 
  > ![20160616180504894.jpg](http://192.168.11.214:8087/android-team/androidteamtogether/raw/master/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E4%BC%9A%E8%AE%AE/picture/%E5%9B%BE%E5%BD%A2%E5%88%86%E4%BA%AB1.jpg)

* 视觉冗余
  
  > 人类的视觉系统由于受生理特性的限制，对于图像场的注意是非均匀的，人对细微的颜色差异感觉不明显。
  > 
  > 例如，人类视觉的一般分辨能力为26灰度等级，而一般的图像的量化采用的是28灰度等级，即存在视觉冗余。
  > 
  > 人类的听觉对某些信号反映不太敏感，使得压缩后再还原有允许范围的变化，人也感觉不出来。

###### 3.JPEG图片压缩算法（有损压缩）

> 不支持透明通道
> 
> 使用的一种失真压缩标准方法，24 bit真彩色，不支持动画、不支持透明色。JPEG的压缩方式通常是破坏性资料压缩,意即在压缩过程中图像的品质会遭受到可见的破坏。一张图片多次上传下载后，图片逐渐会失真。  
> 
> * 优点 
>   
>   - JPEG/JFIF是最普遍在万维网（World Wide Web）上被用来储存和传输照片的格式。JPEG在色调及颜色平滑变化的相片或是写实绘画（painting）上可以达到它最佳的效果。在这种情况下,它通常比完全无失真方法作得更好,仍然可以产生非常好看的影像（事实上它会比其他一般的方法像是GIF产生更高品质的影像,因为GIF对于线条绘画（drawing）和图示的图形是无失真,但针对全彩影像则需要极困难的量化）。
> 
> * 缺点 
>   
>   - 它并不适合于线条绘图（drawing）和其他文字或图示（iconic）的图形,因为它的压缩方法用在这些图形的型态上,会得到不适当的结果。
> 
> 说明：JPEG算法与彩色空间无关，因此“RGB到YUV变换”和“YUV到RGB变换”不包含在JPEG算法中。JPEG算法处理的彩色图像是单独的彩色分量图像，因此它可以压缩来自不同彩色空间的数据，如RGB, YCbCr和CMYK。

参考：[JPEG压缩算法](https://blog.csdn.net/u013752202/article/details/78551592)

参考：[JPEG格式压缩算法](https://www.cnblogs.com/Torrance/p/9349610.html)

###### 4.PNG图片压缩算法（无损压缩）

> 格式是无损数据压缩的,PNG格式有8位、24位、32位三种形式,其中8位PNG支持两种不同的透明形式（索引透明和alpha透明）,24位PNG不支持透明,32位PNG在24位基础上增加了8位透明通道（32-24=8）,因此可展现256级透明程度。  
> 
> + 优点 
>   
>   - 支持256色调色板技术以产生小体积文件 。
>   
>   - 最高支持48位真彩色图像以及16位灰度图像。 
>   
>   - 支持Alpha通道的半透明特性。 
>   
>   - 支持图像亮度的gamma校正信息。 
>   
>   - 支持存储附加文本信息,以保留图像名称、作者、版权、创作时间、注释等信息。 
>   
>   - 使用无损压缩。 
>   
>   - 渐近显示和流式读写,适合在网络传输中快速显示预览效果后再展示全貌。
>   
>   - 使用CRC循环冗余编码防止文件出错。 
>   
>   - 最新的PNG标准允许在一个文件内存储多幅图像。 
> * 缺点 
>   
>   - 但也有一些软件不能使用适合的预测,而造成过分臃肿的PNG文件。

参考：[png图片压缩原理](https://www.cnblogs.com/luov/p/10953981.html)

### 3.YUV

###### 1.YUV是什么？

> Y：明亮度（Luminance、Luma）
> 
> “U”和“V”：色度与浓度（Chrominance、Chroma）
> 
> 起源：黑白电视时代只有灰阶值（Y，也就是明亮度），YUV是为了兼容黑白电视时代所诞生的产物
> 
> Android中Camera产生的数据就是(YUV)NV21，Camera2中是YUV420\_8888

###### 2.YUV与RGB的转换

> YUV是一种类似RGB的颜色模型，起源于黑白和彩电的过渡时期。其中Y代表亮度，uv组合起来可以表示色度。YUV信息只有Y的信息就足以显示黑白的图片，YUV和YCbCr表示相同的东西，且Cb严格对应U，Cr严格对应V，yuv和rgb可以通过固定公式进行转换。
> 
> YUV转RGB：
> 
> ![3832942-584e4f6c489c5a53.webp](/Users/lm233/Downloads/3832942-584e4f6c489c5a53.webp)
> 
> RGB转YUV：
> 
> ![3832942-c125c26b5223e5a0.webp](/Users/lm233/Downloads/3832942-c125c26b5223e5a0.webp)

###### 3.YUV内存

> 图像宽为h，高为w
> 
> - YUV420:
>   
>   Y是w * h，U和V是w/2 * (h/2)  
>   如果w = 4，h = 2，则：  
>   yyyy  
>   yyyy  
>   uu  
>   vv  
>   内存则是：yyyyyyyyuuvv  
>   需要占用的内存：w * h * 3 / 2  
>   采样规律是：每个像素点都采样Y，奇数行采样1/2个U，不采样V，偶数行采样1/2个V，不采样U
> 
> - YUV422:
>   
>   每两个点为一组，共占用4个字节  
>   YUYVYUYV…  
>   对于每一组YUYV，前面一个Y和本组中的UV组成第一个点，第二个Y和本组中的UV组成第二个点  
>   所以，在内存中，宽高分别为w * 2、h。  
>   如果w = 4，h = 2，则：  
>   YUYVYUYV  
>   YUYVYUYV  
>   需要占用的内存：w * h * 2
> 
> YUV主要的采样格式有YCbCr 4\:2:0、YCbCr 4\:2:2、YCbCr 4\:1:1和 YCbCr 4\:4:4。  
> 
> | 采样格式         | 单像素所占内存大小 | 存放的码流                                      |
> |:------------:|:---------:| ------------------------------------------ |
> | YCbCr 4\:4:4 | 3  byte   | Y0 U0 V0 Y1 U1 V1 Y2 U2 V2 Y3 U3 V3（4像素为例） |
> | YCbCr 4\:2:2 | 2  byte   | Y0 U0 Y1 V1 Y2 U2 Y3 V3（4像素为例）             |
> | YCbCr 4\:2:0 | 1.5byte   | Y0 U0 Y1 Y2 U2 Y3 Y5 V5 Y6 Y7 V7 Y8（8像素为例） |
> | YCbCr 4\:1:1 | 1.5byte   | Y0 U0 Y1 Y2 V2 Y3（4像素为例）                   |

### 4.视频编解码（帧）

> * 时间冗余：
>   
>   在视频、动画图像中，相邻帧之间往往存在着时间和空间的相关性。例如，人们在会议室中开会，随着会议的进行，时间在改变，但是背景（房间、家具等）一直是相同的、而且没有移动，变化的只是人们的动作和位置。这里的背景就反映为时间冗余。同样，由于人在说话时产生的音频也是连续和渐变的，因此声音信息中也会存在时间冗余。



> 帧解释
> 
> - I帧：关键帧，可以理解为一张完整的图像
> 
> - P帧：向前预测帧，可以对比前面的帧从而得出完整的画面
> 
> - B帧：双向预测帧，本帧与前后帧的差别（可用于前后对比，视频一般使用较少）

###### 1.I帧和P帧对比

> I帧可以理解为是一个完整的图像，P帧可以理解为是一个叠加的数据（当前时间片中变化的数据）。

###### 2.视频解码最简单原理

> 解码I帧时是全量替换，解码P帧时需要预测前面的帧，根据前面的帧生成新的图像。

###### 3.帧丢失

> * I帧丢失，等待下一个I帧，或者重新获取当前I帧（重新请求）
> 
> * P帧丢失，花屏，如下图
>   
>   ![timg.jpeg](/Users/lm233/Downloads/timg.jpeg)



###### 4.[sps和pps帧](https://zhuanlan.zhihu.com/p/27896239)
